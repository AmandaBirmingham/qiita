{% extends sitebase.html%}

{%block head%}
<link rel="stylesheet" href="/static/vendor/css/jquery.dataTables.css" type="text/css">
<script type="text/javascript" src="/static/vendor/js/jquery.validate.min.js"></script>
<script src="/static/vendor/js/jquery.dataTables.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  //https://github.com/DataTables/Plugins/blob/master/sorting/custom-data-source/dom-checkbox.js
  $.fn.dataTable.ext.order['dom-checkbox'] = function  ( settings, col ) {
      return this.api().column( col, {order:'index'} ).nodes().map( function ( td, i ) {
          return $('input', td).prop('checked') ? '1' : '0';
      } );
  };

  $('#info-table').dataTable({
    "deferRender": true,
    "iDisplayLength": 50,
    "aoColumns": [
            { "sSortDataType": "dom-checkbox" },
            {% for i in headers %}
            null,
            {% end %}
        ]
  });
  // Validation
  $("#portal-form").validate({
    rules:{
      portal:{required:true},
      selected:{required:true},
    },

    messages:{
      portal:{required:"Select a portal"},
      selected:{required:"Select at least one row"}
    },

    errorClass: "help-inline",
    errorElement: "span",
    errorLabelContainer: '.errorTxt',
    highlight:function(element, errorClass, validClass)
    {
      $(element).parents('.control-group').addClass('error');
    },
    unhighlight: function(element, errorClass, validClass)
    {
      $(element).parents('.control-group').removeClass('error');
      $(element).parents('.control-group').addClass('success');
    }
  });
});
</script>
{%end%}

{%block content%}
<div class='row'>
    <div class='col-sm-2'>
    <form role="form" id="portal-form" action="{{submit_url}}" method="post">
    <p><b>Portal:</b> <select name="portal" id="portal">
      <option value=""></option>
      {% for portal in portals %}
      <option value="{{portal}}">{{portal}}</option>
      {% end %}
    </select></p>
    <input type="submit" name="action" value="Add" class="btn btn-info"> <input type="submit" name="action" value="Remove" class="btn btn-danger">
    <div class="errorTxt" style="color:red"></div>
  </div>
  <div class='col-lg-10' style="float:right;height:100%; border-color:black;border-left:solid;border-left-width:2px;">
    <table id="info-table" class="table">
    <thead>
      <tr>
        <td>Select</td>
        {% for head in headers %}
        <td>{{head}}</td>
        {% end %}
      </tr>
    </thead>
    <tbody>
      {% for i in info %}
      <tr>
        <td><input type="checkbox" name="selected" id="selected" value="{{i[id_col]}}"></td>
        {% for head in headers %}
        <td>{{i[head]}}</td>
        {% end %}
    </tr>
    {% end %}
    </tbody>
    </table>
  </form>
  </div>
</div>
{% end %}
