<script type="text/javascript">
  var network = null;
  var nodes = new vis.DataSet([{id: 1, label: "{{artifact_type}}"}]);
  var edges = new vis.DataSet();
  var commands = null;
  var current_node = null;

  function add_command() {
    var command_info = commands[$("#command").val()];
    for(i=0;i<command_info.output.length;i++) {
      var node_id = nodes.length + 1;
      edges.add({ id: edges.length + 1, from: current_node, to: node_id, command_id: command_info.id, label: command_info.command });
      nodes.add({ id: node_id, label: command_info.output[i]});
    }
    network.redraw();
  }

  function remove_command(edge_id) {
    var queue = [edges.get(edge_id).to];
    edges.remove(edge_id);
    while(queue.length !== 0) {
      var current = queue.pop();
      for(var edge in edges.get()) {
        if(edge.from == current) {
          if($.inArray(edge.to, queue) == -1) { queue.add(edge.to); }
          edges.remove(edge.id);
        }
      }
      nodes.remove(current);
    }
    network.redraw();
  }

  function load_command(edge_id) {

  }

  function load_filetype(node_id) {
    $.get('/study/commands/', {artifact_type: nodes.get(node_id).label})
      .done(function ( data ) {
        $("#network-info").empty();
        commands = data.commands;
        $("#network-info").html("<h4>Available Commands</h4>");
        var sel = $('<select>').appendTo('#network-info');
        sel.attr('id', 'command').attr('name', 'command');
        for(i=0;i<commands.length;i++) {
         sel.append($("<option>").attr('value',i).text(commands[i].command));
        }
        var select = $('<button>').appendTo('#network-info');
        select.addClass('btn btn-xs').text('Add Command').click(add_command);
        current_node = node_id;
      });
  }

  $(document).ready(function() {
    // create a network
    var container = document.getElementById('network');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
      nodes: {
        color: '#ffffff',
        font: '16px arial black'
      },
      layout: {
        hierarchical: {
          direction: "LR",
          sortMethod: "directed",
          levelSeparation: 260
        }
      },
      interaction: {
        dragNodes: false,
        dragView: true,
        zoomView: true
      }
    };
    network = new vis.Network(container, data, options);
    network.on('select', function(params) {
          //render the information for the selected artifact ID
          if(+params.nodes !== 0) { load_filetype(+params.nodes); }
        });
  });
</script>

<div id="network" style="width:100%;height:300px;border: 1px solid #ccc;"></div>
<div id="network-info" style="width:100%"></div>